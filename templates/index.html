<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Футбольная аналитика</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f5f7fb}
    header{background:#1f2937;color:#fff;padding:14px 18px;font-weight:600}
    main{max-width:1100px;margin:20px auto;padding:0 12px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    .card h2{margin:0;padding:14px 16px;border-bottom:1px solid #eef2f7;font-size:18px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid #eef2f7;text-align:center;font-size:14px}
    th{background:#f0f4ff;font-weight:700}
    .form{padding:14px 16px}
    .row{display:flex;gap:10px;margin-bottom:10px}
    .row label{flex:1}
    input{width:100%;padding:10px;border:1px solid #d7ddea;border-radius:8px;font-size:14px}
    button{width:100%;padding:12px 14px;border:0;border-radius:10px;background:#2563eb;color:#fff;font-weight:700;cursor:pointer}
    .stats{padding:12px 16px;border-top:1px solid #eef2f7;font-size:14px}
    .muted{color:#6b7280}
  </style>
</head>
<body>
<header>Football App · <span class="muted">сегодня: {{ today }}</span></header>

<main class="grid">
  <section class="card">
    <h2>Прошедшие матчи</h2>
    <div style="overflow:auto">
      <table>
        <thead>
          <tr>
            <th>Дата</th><th>Команда A</th><th>Команда B</th>
            <th>1-й тайм</th><th>Итог</th>
            <th>Total линия</th><th>Фора (дом)</th>
            <th>ОЗ</th><th>∑ голов</th>
            <th>Кэф ТБ</th><th>Кэф ТМ</th><th>Кэф ОЗ:Да</th><th>ОЗ:Нет</th>
          </tr>
        </thead>
        <tbody>
        {% for m in matches %}
          <tr>
            <td>{{ m.date }}</td><td>{{ m.home }}</td><td>{{ m.away }}</td>
            <td>{{ m.ht }}</td><td>{{ m.ft }}</td>
            <td>{{ m.total_line }}</td><td>{{ m.handicap_home }}</td>
            <td>{{ m.btts }}</td><td>{{ m.sum_goals }}</td>
            <td>{{ m.k_over }}</td><td>{{ m.k_under }}</td><td>{{ m.k_btts_yes }}</td><td>{{ m.k_btts_no }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <aside class="card">
    <h2>Подбор по коэффициентам</h2>
    <form class="form" method="post">
      <div class="row">
        <label>Линия тотала
          <input name="total_line" type="number" step="0.25" placeholder="например 2.5">
        </label>
      </div>
      <div class="row">
        <label>Кэф ТБ
          <input name="k_over" type="number" step="0.01" placeholder="например 1.95">
        </label>
        <label>Кэф ТМ
          <input name="k_under" type="number" step="0.01" placeholder="например 1.90">
        </label>
      </div>
      <div class="row">
        <label>Фора (дом)
          <input name="handicap_home" type="number" step="0.25" placeholder="-0.5">
        </label>
        <label>Кэф на фору (дом)
          <input name="k_handicap_home" type="number" step="0.01" placeholder="опц.">
        </label>
      </div>
      <div class="row">
        <label>Кэф ОЗ: Да
          <input name="k_btts_yes" type="number" step="0.01" placeholder="напр. 1.70">
        </label>
        <label>Кэф ОЗ: Нет
          <input name="k_btts_no" type="number" step="0.01" placeholder="напр. 2.10">
        </label>
      </div>
      <button type="submit">Посчитать по истории</button>
    </form>

    {% if stats %}
    <div class="stats">
      {% if stats.total %}
        <div><b>Тотал {{ request.form.total_line }}:</b> совпадений {{ stats.total.n }}, проход ТБ — {{ stats.total.wins_over }} ({{ stats.total.p_over }}%).</div>
      {% endif %}
      {% if stats.handicap %}
        <div><b>Фора (дом) {{ request.form.handicap_home }}:</b> совпадений {{ stats.handicap.n }}, проход — {{ stats.handicap.wins }} ({{ stats.handicap.p }}%).</div>
      {% endif %}
      {% if stats.btts %}
        <div><b>Обе забьют:</b> совпадений {{ stats.btts.n }}, «Да» — {{ stats.btts.yes }} ({{ stats.btts.p_yes }}%).</div>
      {% endif %}
      <div class="muted">Сравнение по коэффициентам идёт с допуском ±0.05.</div>
    </div>
    {% endif %}
  </aside>
</main>
</body>
</html>

